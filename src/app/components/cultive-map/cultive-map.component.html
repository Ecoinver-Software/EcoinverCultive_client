<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 p-4">
  <div class="container mx-auto space-y-4">

    <!-- Selector de Género (Rediseñado) -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-md border border-gray-200/50 dark:border-gray-700/50 overflow-hidden transition-all duration-300 hover:shadow-lg hover:translate-y-[-2px] backdrop-blur-sm backdrop-filter mb-6">
      <!-- Header con título y selector -->
      <div class="px-5 sm:px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-0 bg-gradient-to-r from-white to-gray-50 dark:from-gray-800 dark:to-gray-800/80">
        <div class="flex items-center gap-3">
          <div class="p-2 bg-indigo-50 dark:bg-indigo-900/30 rounded-lg transition-transform duration-300 hover:scale-110 hover:rotate-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 dark:text-indigo-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="8" y1="6" x2="21" y2="6" />
              <line x1="8" y1="12" x2="21" y2="12" />
              <line x1="8" y1="18" x2="21" y2="18" />
              <line x1="3" y1="6" x2="3.01" y2="6" />
              <line x1="3" y1="12" x2="3.01" y2="12" />
              <line x1="3" y1="18" x2="3.01" y2="18" />
            </svg>
          </div>
          <h2 class="text-lg font-semibold text-gray-900 dark:text-white animate-fade-in">Cultivos</h2>
        </div>
        <div class="flex items-center gap-2 w-full sm:w-auto">
          <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-0.5 flex text-xs w-full sm:w-auto shadow-sm animate-slide-in-right">
            <button class="py-1.5 px-4 rounded-md bg-indigo-600 text-white font-medium shadow-sm transition-all duration-200 hover:scale-105">
              Todos
            </button>
            <button class="py-1.5 px-4 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/70 transition-all duration-200 hover:scale-105">
              Seleccionados <span class="inline-flex items-center justify-center ml-1 w-5 h-5 text-xs font-medium rounded-full bg-indigo-100 text-indigo-800 dark:bg-indigo-900/50 dark:text-indigo-300 transition-transform duration-300 animate-pulse">(0)</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Filtros mejorados -->
      <div class="px-5 sm:px-6 py-4 border-b border-gray-200 dark:border-gray-700">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
          <!-- Búsqueda mejorada -->
          <div class="relative group lg:col-span-5 animate-fade-in" style="animation-delay: 100ms;">
            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400 dark:text-gray-500 group-focus-within:text-indigo-500 dark:group-focus-within:text-indigo-400 transition-colors transition-transform duration-300 group-hover:scale-110" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input 
              type="text" 
              [(ngModel)]="texto" 
              placeholder="Buscar cultivos..." 
              class="pl-10 h-10 w-full text-sm bg-gray-50 dark:bg-gray-700/70 border border-gray-200 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 focus:border-transparent dark:text-white dark:placeholder-gray-400 transition-all duration-300 hover:border-indigo-300 dark:hover:border-indigo-500 focus:scale-[1.01]" 
            />
          </div>


        <!-- Select de familia -->
          <div class="relative group lg:col-span-5 animate-fade-in" style="animation-delay: 200ms;">
            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400 dark:text-gray-500 group-focus-within:text-indigo-500 dark:group-focus-within:text-indigo-400 transition-colors transition-transform duration-300 group-hover:scale-110" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
            </svg>
            <select 
              [(ngModel)]="familiaSeleccionada" 
              class="pl-10 h-10 w-full text-sm bg-gray-50 dark:bg-gray-700/70 border border-gray-200 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 focus:border-transparent dark:text-white appearance-none transition-all duration-300 hover:border-indigo-300 dark:hover:border-indigo-500 focus:scale-[1.01]"
            >
              <option value="todas">Todas las familias</option>
              <option *ngFor="let fam of family" [value]="fam.familia">{{ fam.familia }}</option>
            </select>
            <svg xmlns="http://www.w3.org/2000/svg" class="absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400 dark:text-gray-500 pointer-events-none transition-transform duration-300 group-hover:translate-y-[2px]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>


        <!-- Botón limpiar -->
          <div class="lg:col-span-2 animate-fade-in" style="animation-delay: 300ms;">
            <button 
              (click)="texto=''; familiaSeleccionada='todas'" 
              class="h-10 px-4 w-full text-sm border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 font-medium transition-all duration-300 hover:scale-[1.03] hover:shadow-md flex items-center justify-center gap-1.5 hover:border-red-200 dark:hover:border-red-800"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 transition-transform duration-300 group-hover:rotate-90" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
              Limpiar filtros
            </button>
          </div>
        </div>
      </div>

      <!-- Listado de Géneros -->
      <div class="p-5 sm:px-6 py-5">
        <div class="max-h-64 overflow-y-auto pr-1 custom-scrollbar">
          <ng-container *ngFor="let fam of busquedaFamilia; let i = index">
            <div [style]="{'animation-delay': (i * 100) + 'ms'}" class="mb-5 animate-slide-up">
              <h3 class="text-xs font-medium text-gray-500 dark:text-gray-300 mb-3">{{ fam.familia }}</h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-3">
                <ng-container *ngFor="let gen of fam.nombreGenero; let j = index">
                  <div [style]="{'animation-delay': ((i * 100) + (j * 50)) + 'ms'}" class="flex items-center gap-3 p-3 rounded-lg border border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-all duration-300 cursor-pointer hover:scale-[1.02] hover:shadow-md animate-slide-up" [class.border-indigo-200]="selectedGeneroId === gen.id" [class.dark:border-indigo-700]="selectedGeneroId === gen.id" [class.bg-indigo-50]="selectedGeneroId === gen.id" [class.dark:bg-indigo-900]="selectedGeneroId === gen.id" (click)="onGeneroSelect(gen.id)">
                    <div class="flex-shrink-0 w-8 h-8 bg-indigo-100 dark:bg-indigo-900/30 rounded-full flex items-center justify-center transition-all duration-300 group-hover:scale-110">
                      <span class="text-indigo-700 dark:text-indigo-400 font-medium text-sm">{{gen.nombre.charAt(0).toUpperCase()}}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                      <h3 class="text-sm font-medium text-gray-900 dark:text-white truncate">{{gen.nombre}}</h3>
                    </div>
                    <!-- Indicador de selección -->
                    <div class="flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all duration-300" [class.border-gray-300]="selectedGeneroId !== gen.id" [class.dark:border-gray-600]="selectedGeneroId !== gen.id" [class.border-indigo-500]="selectedGeneroId === gen.id" [class.dark:border-indigo-400]="selectedGeneroId === gen.id" [class.scale-110]="selectedGeneroId === gen.id">
                      <div *ngIf="selectedGeneroId === gen.id" class="w-3 h-3 bg-indigo-500 dark:bg-indigo-400 rounded-full animate-scale-in"></div>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
          </ng-container>
        </div>
      </div>

      <!-- Footer -->
      <div class="px-5 sm:px-6 py-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/80 text-xs text-gray-500 dark:text-gray-400 animate-slide-up" style="animation-delay: 400ms;">
        Filtrando por:
        <span class="text-indigo-600 dark:text-indigo-400 font-medium ml-1">
          {{ familiaSeleccionada === 'todas' ? 'Todas las familias' : familiaSeleccionada }}
        </span>
      </div>
    </div>

    <!-- Panel de Gráficos -->
    <div *ngIf="superficieTotal > 0" class="bg-white dark:bg-gray-800 rounded-2xl shadow-md border border-gray-200/50 dark:border-gray-700/50 overflow-hidden transition-all duration-300 hover:shadow-lg hover:translate-y-[-2px] backdrop-blur-sm backdrop-filter animate-slide-up" style="animation-delay: 500ms;">
      
      <!-- Controles de Vista y Agrupación -->
      <div class="flex flex-col sm:flex-row justify-between mb-4 gap-4">
        <!-- Pestañas de Vista -->
        <div class="inline-flex bg-gray-100 dark:bg-gray-700 rounded-md p-1 text-sm">
          <button
            class="px-3 py-1 rounded-md focus:outline-none"
            [ngClass]="{ 'bg-indigo-600 text-white': view==='pie', 'text-gray-600 dark:text-gray-300': view!=='pie' }"
            (click)="view='pie'"
          >
            Gráfico Circular
          </button>
          <button
            class="px-3 py-1 rounded-md focus:outline-none"
            [ngClass]="{ 'bg-indigo-600 text-white': view==='tree', 'text-gray-600 dark:text-gray-300': view!=='tree' }"
            (click)="view='tree'"
          >
            Treemap
          </button>
        </div>

        <!-- Botones de Agrupación / Desagrupar -->
        <div class="inline-flex bg-gray-100 dark:bg-gray-700 rounded-md p-1 text-sm overflow-x-auto">
          <button
            (click)="groupBy='variedad'; updateChart()"
            class="px-3 py-1 rounded-md whitespace-nowrap focus:outline-none"
            [ngClass]="{ 'bg-indigo-600 text-white': groupBy==='variedad', 'text-gray-600 dark:text-gray-300': groupBy!=='variedad' }"
          >
            Variedad
          </button>
          <button
            (click)="groupBy='agricultor'; updateChart()"
            class="px-3 py-1 rounded-md whitespace-nowrap focus:outline-none"
            [ngClass]="{ 'bg-indigo-600 text-white': groupBy==='agricultor', 'text-gray-600 dark:text-gray-300': groupBy!=='agricultor' }"
          >
            Agricultor
          </button>
          <button
            (click)="groupBy='individual'; updateChart()"
            class="px-3 py-1 rounded-md whitespace-nowrap focus:outline-none"
            [ngClass]="{ 'bg-indigo-600 text-white': groupBy==='individual', 'text-gray-600 dark:text-gray-300': groupBy!=='individual' }"
          >
            Cultivo
          </button>
          <button
            (click)="groupBy='tecnico'; updateChart()"
            class="px-3 py-1 rounded-md whitespace-nowrap focus:outline-none"
            [ngClass]="{ 'bg-indigo-600 text-white': groupBy==='tecnico', 'text-gray-600 dark:text-gray-300': groupBy!=='tecnico' }"
          >
            Técnico
          </button>
          <button
            (click)="groupBy='provincia'; updateChart()"
            class="px-3 py-1 rounded-md whitespace-nowrap focus:outline-none"
            [ngClass]="{ 'bg-indigo-600 text-white': groupBy==='provincia', 'text-gray-600 dark:text-gray-300': groupBy!=='provincia' }"
          >
            Provincia
          </button>
        </div>
      </div>

      

      <!-- Contenedores ECharts responsivos -->
      <div echarts [options]="optionsPie" class="w-full h-64 sm:h-80" *ngIf="view==='pie'"></div>
      <div echarts [options]="optionsTree" class="w-full h-64 sm:h-80" *ngIf="view==='tree'"></div>
      
      <!-- Info -->
      <div *ngIf="superficieTotal > 0" class="px-5 sm:px-6 py-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/80 text-xs text-gray-500 dark:text-gray-400 animate-slide-up" style="animation-delay: 800ms;">
        Superficie total: <span class="text-indigo-600 dark:text-indigo-400 font-medium">{{superficieTotal}} m²</span> | 
        Modo de agrupación: <span class="text-indigo-600 dark:text-indigo-400 font-medium">{{groupBy === 'variedad' ? 'Variedad' : groupBy === 'agricultor' ? 'Agricultor' : groupBy === 'individual' ? 'Cultivo' : groupBy === 'tecnico' ? 'Técnico' : 'Provincia'}}</span>
      </div>
    </div>

  </div>
</div>
